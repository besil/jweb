<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="JWeb : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>JWeb</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/besil/jweb">View on GitHub</a>

          <h1 id="project_title">JWeb</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/besil/jweb/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/besil/jweb/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="jweb" class="anchor" href="#jweb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JWeb</h1>

<p>JWeb is a framework for developing and testing easily rest services.
It is built around <a href="http://sparkjava.com/">Spark</a>,
according with the <a href="https://sparktutorials.github.io/2015/07/30/spark-testing-unit.html">Spark testing guide</a></p>

<p>The framework aims to be a library with support for common funcionalities
(such as pojo request mapping, session management),
similarly to Django or other common web frameworks.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>Please clone the repo and include it as maven dependency</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;it.besil.web&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;jweb&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.0.0&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<h2>
<a id="quickstart" class="anchor" href="#quickstart" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quickstart</h2>

<p>We will create a simple Echo Rest Server, with unit testing. Full code <a href="https://github.com/besil/jwebsample">here</a>.</p>

<p>In JWeb, there are a very few concepts to remember: an <strong>App</strong> is the main block of your application. An App
incapsulates one or more <strong>Controllers</strong> and <strong>Filters</strong>.</p>

<p><strong>Controllers</strong> defines the business logic for a resource. A Controller is made of 3 elements:</p>

<ol>
<li><p>A <em>path</em>, which is the resource url exposed by the server</p></li>
<li><p>A <em>method</em> (ie GET, POST, ...) for the resource</p></li>
<li><p>A <em>handler</em>, which contains the business logic associated to the specific resource for that method</p></li>
</ol>

<p>An <strong>handler</strong> consumes a <strong>Payload</strong> and produce an <strong>Answer</strong>, according to the business logic.</p>

<p><strong>Payloads</strong> are user defined POJO, which extracts parameters from http requests.
<strong>Answers</strong> are simple objects with a status code and a map of key-values to return.</p>

<p><strong>Filters</strong> are very similar to handlers, but they are executed <em>before</em> or <em>after</em> each request/response.</p>

<p>Enough reading, let's see some code</p>

<p>This is your main:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> main(<span class="pl-k">String</span>[] args) throws <span class="pl-smi">IOException</span> {
    <span class="pl-smi">JWebConfiguration</span> conf <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JWebConfiguration</span>();
    <span class="pl-smi">JWebServer</span> jweb <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">JWebServer</span>(conf);
    jweb<span class="pl-k">.</span>addApp(<span class="pl-k">new</span> <span class="pl-smi">EchoApp</span>());
    <span class="pl-c">// You can add here as many apps as you want</span>
}</pre></div>

<p>The EchoApp is (about 60 lines of code, 3 classes):</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">EchoApp</span> <span class="pl-k">extends</span> <span class="pl-e">JWebApp</span> {
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">EchoPayload</span> <span class="pl-k">implements</span> <span class="pl-e">Payload</span> {
        <span class="pl-k">private</span> <span class="pl-smi">String</span> message;

        <span class="pl-k">public</span> <span class="pl-en">EchoPayload</span>() {

        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">init</span>(<span class="pl-smi">Request</span> <span class="pl-v">req</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>message <span class="pl-k">=</span> req<span class="pl-k">.</span>queryParams(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>);
        }

        <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getMessage</span>() {
            <span class="pl-k">return</span> message;
        }
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">GetEchoHandler</span> <span class="pl-k">extends</span> <span class="pl-e">JWebHandler&lt;<span class="pl-smi">EchoPayload</span>&gt;</span> {
        <span class="pl-k">public</span> <span class="pl-en">GetEchoHandler</span>() {
            <span class="pl-v">super</span>(<span class="pl-smi">EchoPayload</span><span class="pl-k">.</span>class);
        }

        <span class="pl-k">@Override</span>
        <span class="pl-k">public</span> <span class="pl-smi">Answer</span> <span class="pl-en">process</span>(<span class="pl-smi">EchoPayload</span> <span class="pl-v">ep</span>) {
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">SuccessAnswer</span>(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Echo: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> ep<span class="pl-k">.</span>getMessage());
        }
    }

    <span class="pl-k">@Override</span>
        <span class="pl-k">public</span> <span class="pl-k">List&lt;? extends <span class="pl-smi">JWebController</span>&gt;</span> <span class="pl-en">getControllers</span>() {
            <span class="pl-c">// Every app can be made by different controllers.</span>
            <span class="pl-c">// Each controller must specify</span>
            <span class="pl-c">// the method, the path where to bind and the handler</span>
            <span class="pl-k">return</span> <span class="pl-smi">Arrays</span><span class="pl-k">.</span>asList(<span class="pl-k">new</span> <span class="pl-smi">JWebController</span>() {
                <span class="pl-k">public</span> <span class="pl-smi">HttpMethod</span> <span class="pl-en">getMethod</span>() {
                    <span class="pl-k">return</span> <span class="pl-smi">HttpMethod</span><span class="pl-k">.</span>get;
                }

                <span class="pl-k">public</span> <span class="pl-smi">JWebHandler</span> <span class="pl-en">getHandler</span>() {
                    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">GetEchoHandler</span>();
                }

                <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getPath</span>() {
                    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>/api/echo<span class="pl-pds">"</span></span>;
                }
            });
        }
}</pre></div>

<p>Run it, and open <a href="http://localhost:4567/api/echo?message=hello">localhost</a>. You will see your message echoed back.</p>

<p>About <strong>testing</strong>, I found useful testing web services like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">EchoTest</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractBehaviouralTest</span> {
    <span class="pl-k">@Before</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">init</span>() {
        <span class="pl-v">this</span><span class="pl-k">.</span>addApp(<span class="pl-k">new</span> <span class="pl-smi">EchoApp</span>());
    }

    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">simpleTest</span>() <span class="pl-k">throws</span> <span class="pl-smi">UnirestException</span> {
        <span class="pl-k">HttpResponse&lt;<span class="pl-smi">JsonNode</span>&gt;</span> resp <span class="pl-k">=</span> <span class="pl-smi">Unirest</span><span class="pl-k">.</span>get(getUrl(<span class="pl-s"><span class="pl-pds">"</span>/api/echo<span class="pl-pds">"</span></span>))
                .queryString(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>ciao<span class="pl-pds">"</span></span>)
                .asJson();
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(<span class="pl-s"><span class="pl-pds">"</span>Echo: ciao<span class="pl-pds">"</span></span>,
            resp<span class="pl-k">.</span>getBody()<span class="pl-k">.</span>getObject()<span class="pl-k">.</span>getString(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>));
    }
}</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">JWeb maintained by <a href="https://github.com/besil">besil</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
